!function(W,r,a){"use strict";var S=W.ht;S.Astar={},function(M){var h=M();W.AStar=h.astar,W.AStar.Graph=h.Graph}(function(){function g(h){for(var r=h,Q=[];r.parent;)Q.unshift(r),r=r.parent;return Q}function T(){return new l(function(K){return K.f})}function j(W,s){s=s||{},this.nodes=[],this.diagonal=!!s.diagonal,this.grid=[];for(var w=0;w<W.length;w++){this.grid[w]=[];for(var j=0,n=W[w];j<n.length;j++){var h=new q(w,j,n[j]);this.grid[w][j]=h,this.nodes.push(h)}}this.$13x()}function q(t,L,Z){this.x=t,this.y=L,this.weight=Z}function l(X){this.content=[],this.scoreFunction=X}var _={search:function(b,P,d,h){b.$6x(),h=h||{};var Z=h.heuristic;Z||(Z=b.diagonal?_.$4x.diagonal:_.$4x.manhattan);var v=h.closest||!1,k=h.punish,r=T(),D=P;for(P.h=Z(P,d),b.$7x(P),r.push(P);r.size()>0;){var M=r.pop();if(M===d)return g(M);M.closed=!0;for(var n=b.neighbors(M),w=0,o=n.length;o>w;++w){var N=n[w];if(!N.closed&&!N.$9x()){var B=M.g+N.getCost(M,k),u=N.visited;(!u||B<N.g)&&(N.visited=!0,N.parent=M,N.h=N.h||Z(N,d),N.g=B,N.f=N.g+N.h,b.$7x(N),v&&(N.h<D.h||N.h===D.h&&N.g<D.g)&&(D=N),u?r.$10x(N):r.push(N))}}}return v?g(D):[]},$4x:{manhattan:function(O,k){var J=Math.abs(k.x-O.x),u=Math.abs(k.y-O.y);return J+u},diagonal:function(A,F){var v=1,G=Math.sqrt(2),V=Math.abs(F.x-A.x),q=Math.abs(F.y-A.y);return v*(V+q)+(G-2*v)*Math.min(V,q)}},$5x:function(z){z.f=0,z.g=0,z.h=0,z.visited=!1,z.closed=!1,z.parent=null}};return j.prototype.$13x=function(){this.dirtyNodes=[];for(var m=0;m<this.nodes.length;m++)_.$5x(this.nodes[m])},j.prototype.$6x=function(){for(var Z=0;Z<this.dirtyNodes.length;Z++)_.$5x(this.dirtyNodes[Z]);this.dirtyNodes=[]},j.prototype.$7x=function(w){this.dirtyNodes.push(w)},j.prototype.neighbors=function(Q){var l=[],U=Q.x,j=Q.y,I=this.grid;return I[U-1]&&I[U-1][j]&&l.push(I[U-1][j]),I[U+1]&&I[U+1][j]&&l.push(I[U+1][j]),I[U]&&I[U][j-1]&&l.push(I[U][j-1]),I[U]&&I[U][j+1]&&l.push(I[U][j+1]),this.diagonal&&(I[U-1]&&I[U-1][j-1]&&l.push(I[U-1][j-1]),I[U+1]&&I[U+1][j-1]&&l.push(I[U+1][j-1]),I[U-1]&&I[U-1][j+1]&&l.push(I[U-1][j+1]),I[U+1]&&I[U+1][j+1]&&l.push(I[U+1][j+1])),l},j.prototype.toString=function(){for(var G=[],c=this.grid,k=0;k<c.length;k++){for(var U=[],u=c[k],C=0;C<u.length;C++)U.push(u[C].weight);G.push(U.join(" "))}return G.join("\n")},q.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},q.prototype.getCost=function(d,X){var Z;if(Z=d&&d.x!=this.x&&d.y!=this.y?1.41421*this.weight:this.weight,X){var D=d;if(!D)return Z;var l=D.parent;if(!l)return Z;if(Math.abs(l.x+this.x-2*D.x)>1e-5)return Z+X;if(Math.abs(l.y+this.y-2*D.y)>1e-5)return Z+X}return Z},q.prototype.$9x=function(){return 0===this.weight},l.prototype={push:function(E){this.content.push(E),this.$11x(this.content.length-1)},pop:function(){var X=this.content[0],Y=this.content.pop();return this.content.length>0&&(this.content[0]=Y,this.$12x(0)),X},remove:function(F){var Z=this.content.indexOf(F),C=this.content.pop();Z!==this.content.length-1&&(this.content[Z]=C,this.scoreFunction(C)<this.scoreFunction(F)?this.$11x(Z):this.$12x(Z))},size:function(){return this.content.length},$10x:function(z){this.$11x(this.content.indexOf(z))},$11x:function(A){for(var D=this.content[A];A>0;){var v=(A+1>>1)-1,X=this.content[v];if(!(this.scoreFunction(D)<this.scoreFunction(X)))break;this.content[v]=D,this.content[A]=X,A=v}},$12x:function(X){for(var I=this.content.length,h=this.content[X],b=this.scoreFunction(h);;){var f,g=X+1<<1,U=g-1,S=null;if(I>U){var l=this.content[U];f=this.scoreFunction(l),b>f&&(S=U)}if(I>g){var s=this.content[g],n=this.scoreFunction(s);(null===S?b:f)>n&&(S=g)}if(null===S)break;this.content[X]=this.content[S],this.content[S]=h,X=S}}},{astar:_,Graph:j}});var t=S.Astar.Finder=function(X,y){var k=this;k.gv=X,k.$13x(y),k.refreshMap()};t.prototype={},t.prototype.constructor=t,r.defineProperties(t.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(X){this.gv._astarDebugInfo=X}}}),t.prototype.$13x=function(u){var X=this,W=X.$14x={};u=u||{};var x=u.gridSize||10;W.gridSizeX=u.gridSizeX||x,W.gridSizeY=u.gridSizeY||x,W.rect=u.rect,W.filter=u.filter,W.extendBlocks=u.extendBlocks||3,W.fastOverlap=u.fastOverlap===a?!0:u.fastOverlap,W.nodeRectExtend=u.nodeRectExtend||0,W.diagonal=u.diagonal===a?!0:u.diagonal,W.turnPunish=u.turnPunish===a?.1:u.turnPunish,W.simplify=u.simplify===a?!0:u.simplify,W.toGridCenter=u.toGridCenter===a?!1:u.toGridCenter,W.closest=u.closest===a?!0:u.closest},t.prototype.refreshMap=function(){var x,b=this,L=b.$14x,M=L.gridSizeX,E=L.gridSizeY,c=L.extendBlocks;L.rect?x=L.rect:(x=b.$15x(),S.Default.grow(x,M*c,E*c)),S.Default.grow(x,M,E);var n=Math.floor(x.x/M)*M,Q=Math.floor(x.y/E)*E,P=Math.ceil(x.width/M),r=Math.ceil(x.height/E),Z=P*M,m=r*E;b.$16x={x:n,y:Q,w:Z,h:m,gridX:M,gridY:E,xLen:P,yLen:r},b.$17x(),b.$21x()},t.prototype.$15x=function(){var o=this.gv;if(o instanceof S.graph.GraphView)return o.getContentRect();var x,d=S.Default.unionRect;return o.dm().each(function(C){o.isVisible(C)&&C.getRect&&(x=d(x,C.getRect()))}),x},t.prototype.$17x=function(){var L,J,f,B,N=this,x=N.$16x,s=x.xLen,_=x.yLen;for(L=new Array(s),f=0;s>f;f++)for(L[f]=J=new Array(_),B=_;B--;)J[B]=1;var c=N.$14x.filter;for(N.gv.dm().each(function(b){c&&c(b)===!1||(!N._debugInfo||b!==N._debugInfo.grid&&b!=N._debugInfo.path)&&N.$1cw(L,b)}),f=0;s>f;f++)L[f][0]=1,L[f][_-1]=1;for(B=0;_>B;B++)L[0][B]=1,L[s-1][B]=1;N.grid=L;var H=new AStar.Graph(L,{diagonal:N.$14x.diagonal});N.graph=H},t.prototype.$18x=function(Q,z,I,A,s,n,G,U){var i=this.$19x,e=i(I-Q,s-G,A-z,n-U);if(1e-6>=e&&e>=-1e-6)return!1;var J=i(s-Q,s-G,n-z,n-U)/e;if(0>J||J>1)return!1;var T=i(I-Q,s-Q,A-z,n-z)/e;return 0>T||T>1?!1:!0},t.prototype.$19x=function(Q,b,z,w){return Q*w-b*z},t.prototype.$1aw=function(u,O,s,N){for(var C=[-(O[1]-u[1]),O[0]-u[0]],Y=C[0]*(s[0]-u[0])+C[1]*(s[1]-u[1])>=0,D=0,G=N.length;G>D;D+=2)if(C[0]*(N[D]-u[0])+C[1]*(N[D+1]-u[1])>=0===Y)return!1;return!0},t.prototype.$1bw=function(q,r){for(var D,p,P=this,T=0,C=q.length;C>T;T+=2)if(D=T===C-2?0:T+2,p=D===C-2?0:D+2,P.$1aw([q[T],q[T+1]],[q[D],q[D+1]],[q[p],q[p+1]],r))return!1;for(var T=0,C=r.length;C>T;T+=2)if(D=T===C-2?0:T+2,p=D===C-2?0:D+2,P.$1aw([r[T],r[T+1]],[r[D],r[D+1]],[r[p],r[p+1]],q))return!1;return!0},t.prototype.$1cw=function(b,k){if(k.getRect){var D=this,I=k.getRect();S.Default.grow(I,D.$14x.nodeRectExtend);var U,y,m,V,C,s,_,r,J,B,P,x=D.$1dw({x:I.x,y:I.y}),u=D.$1dw({x:I.x+I.width,y:I.y+I.height}),f=D.$14x.fastOverlap;if(!f){var M=k.getCorners();_=[],M.forEach(function(l){_.push(l.x,l.y)}),B=D.$14x.gridSizeX/2,P=D.$14x.gridSizeY/2}for(y=Math.max(0,x.x),m=Math.min(u.x,b.length-1),C=Math.max(0,x.y),s=Math.min(u.y,b.length?b[0].length-1:-1),U=y;m>=U;U++)for(V=C;s>=V;V++)if(f)b[U][V]=0;else{J=D.$1ew({x:U,y:V});var X=J.x-B,A=J.x+B,l=J.y-P,E=J.y+P;r=[X,l,X,E,A,E,A,l],D.$1bw(_,r)&&(b[U][V]=0)}}},t.prototype.$1dw=function(o,K){var H=this,G=H.$16x,c=(o.x-G.x)/G.gridX,p=(o.y-G.y)/G.gridY;return K!==!1&&(c=Math.round(c),p=Math.round(p)),{x:c,y:p}},t.prototype.$1ew=function(K){var r=this,B=r.$16x;return{x:K.x*B.gridX+B.x,y:K.y*B.gridY+B.y}},t.prototype.$1fw=function(a){var G=this,t=G.$16x,P=t.xLen,M=t.yLen;if(a.x>=0&&a.x<P&&a.y>=0&&a.y<M)return a;var $={x:a.x,y:a.y};return $.x<0?$.x=0:$.x>=P&&($.x=P-1),$.y<0?$.y=0:$.y>=M&&($.y=M-1),$},t.prototype.findPath=function(A,P){var V,O,m,e,f=this,W=f.$1dw(A),c=f.$1dw(P);if(m=f.$1fw(W),e=f.$1fw(c),m!==W&&e!==c){var C=f.$16x,G=C.x-C.gridX/2,k=C.y-C.gridY/2,H=G+C.gridX*C.xLen,s=k+C.gridY*C.yLen;if(!(f.$18x(A.x,A.y,P.x,P.y,G,k,H,k)||f.$18x(A.x,A.y,P.x,P.y,H,k,H,s)||f.$18x(A.x,A.y,P.x,P.y,H,s,G,s)||f.$18x(A.x,A.y,P.x,P.y,G,s,G,k)))return[A,P]}m!==W&&(V=!0,W=m),e!==c&&(O=!0,c=e);var Q=f.graph.grid[W.x][W.y],y=f.graph.grid[c.x][c.y],i=AStar.search(f.graph,Q,y,{closest:f.$14x.closest,punish:f.$14x.turnPunish});if(!i||!i.length)return null;var q=[];q.push(A),V&&q.push(f.$1ew(i[0]));for(var M=1,l=i.length;l-1>M;M++)q.push(f.$1ew(i[M]));if(O)q.push(f.$1ew(i[l-1])),q.push(P);else{var S=i[l-1];c.x!==S.x||c.y!==S.y||f.$14x.toGridCenter?q.push(f.$1ew(S)):q.push(P)}return f.$14x.simplify&&(q=f.simplifyPath(q)),f.$20x=q,f.$21x(),q},t.prototype.debugOn=function(C){this.debugFlag=!0,this.debugSettings=C||{},this.$21x()},t.prototype.simplifyPath=function(J){var O=J.length;if(2>=O)return J;var r,X,l=[J[0],J[1]],h=l[0],f=l[1],N=1e-5;for(r=2;O>r;r++)X=J[r],Math.abs((f.x-h.x)*(X.y-h.y)-(f.y-h.y)*(X.x-h.x))<N?f=l[l.length-1]=X:(h=f,f=X,l.push(X));return l},t.prototype.$21x=function(){var m=this;if(m.$22x(),this.debugFlag){var r=m.grid;if(r){var A,D=m.gv;if(m.debugSettings.$16x!==!1){A=[];for(var s,o,p,v,x,C=[],N=m.$14x.gridSizeX/2,z=m.$14x.gridSizeY/2,t=r.length,k=t?r[0].length:0,F=1;t-1>F;F++)for(var I=1;k-1>I;I++)r[F][I]||(s=m.$1ew({x:F,y:I}),o=s.x-N,p=s.x+N,v=s.y-z,x=s.y+z,A.push({x:o,y:v},{x:o,y:x},{x:p,y:x},{x:p,y:v}),C.push(1,2,2,2,5));var M=new S.Shape;M.s("shape.border.color","rgba(50, 50, 50, 0.2)"),M.s("shape.border.width",1),M.s("shape.background","rgba(200, 50, 100, 0.2)"),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.setPoints(A),M.setSegments(C),m._debugInfo={grid:M},D.dm().add(M)}m.debugSettings.path!==!1&&(A=new S.Shape,m.$20x&&(A.setPoints(m.$20x),A.s("shape.border.color","red"),A.s("shape.border.width",1),A.s("2d.editable",!1),A.s("2d.selectable",!1),A.s("shape.background",null),m._debugInfo||(m._debugInfo={}),m._debugInfo.path=A,D.dm().add(A)))}}},t.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},t.prototype.$22x=function(){var V=this;if(V._debugInfo){var j=V._debugInfo.grid,L=V._debugInfo.path,d=V.gv;j&&d.dm().remove(j),L&&d.dm().remove(L),V._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);