!function(m,M){"use strict";var u="ht",L=u+".layout.",x=m[u]||module.parent.exports.ht,n=x.List,j=x.DataModel,O=x.Node,E=x.Edge,N=x.Group,i=Math,p=i.sqrt,U=i.random,H=i.max,G=i.min,B=function(r){return r*r};x.Default.getInternal().addMSMap({ms_force:function(p){p._interval=50,p._stepCount=10,p._motionLimit=.01,p._edgeRepulsion=.65,p._nodeRepulsion=.65,p._damper=1,p._maxMotion=0,p._motionRatio=0,p.init=function(A){var U=this;A instanceof j?U.dm=A:U.gv=A,U._nodeMap={},U._nodes=new n,U._edges=new n},p.start=function(){var S=this,r=S.gv;if(!S._timer){var a=S.cdm=r?r.dm():S.dm;a.mm(S.handleDataModelChange,S),a.md(S.handleDataPropertyChange,S),r&&r.mp(S.handleGV,S),a.each(function(Z){if(S.isVisible(Z)&&S.isLayoutable(Z)&&Z instanceof O)if(S instanceof y){var d=Z.p3();Z.p3([d[0]+U(),d[1]+U(),d[2]+U()])}else d=Z.p(),Z.p(d.x+U(),d.y+U())}),S._timer=setInterval(function(){S.relax()},S._interval),S._damper=1}},p.stop=function(){var T=this;T._timer&&(T.cdm.umm(T.handleDataModelChange,T),T.cdm.umd(T.handleDataPropertyChange,T),T.gv&&T.gv.ump(T.handleGV,T),clearInterval(T._timer),delete T._timer,delete T.cdm)},p.handleGV=function(z){var v=this;if("dataModel"===z.property){var f=z.oldValue,$=z.newValue;f&&(f.umm(v.handleDataModelChange,v),f.umd(v.handleDataPropertyChange,v)),this.cdm=$,$.mm(v.handleDataModelChange,v),$.md(v.handleDataPropertyChange,v)}},p.relax=function(){var G=this;if(!(G._damper<.1&&G._maxMotion<G._motionLimit)){this.cdm.each(function(d){G.isVisible(d)&&(d instanceof E?G.addEdge(d):d instanceof O&&G.addNode(d))});for(var s,k,f=0,b=G._edges,B=G._nodes,A=B.size();f<G._stepCount;f++){for(b.each(G.relaxEdge,G),s=0;A>s;s++)for(k=0;A>k;k++)G.relaxNode(B.get(s),B.get(k));G.moveNode()}G._isAdjusting=1,B.each(function(l){l.fix||(l.p?l.v.p3(l.p):l.v.p(l.x,l.y))}),delete G._isAdjusting,G._nodeMap={},B.clear(),b.clear(),G.onRelaxed()}},p.onRelaxed=function(){},p.isRunning=function(){return!!this._timer},p.isVisible=function(d){return d.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(d):!0},p.isLayoutable=function(m){if(m.s("layoutable")===!1)return!1;if(m instanceof N)return!1;var S=this;return S.gv?S.gv.isMovable(m)&&!S.gv.isSelected(m):!(S.cdm||S.dm).sm().co(m)},p.getNodeRepulsion=function(){return this._nodeRepulsion},p.setNodeRepulsion=function(x){this._nodeRepulsion=x,this._damper=1},p.getEdgeRepulsion=function(){return this._edgeRepulsion},p.setEdgeRepulsion=function(L){this._edgeRepulsion=L,this._damper=1},p.getStepCount=function(){return this._stepCount},p.setStepCount=function(t){this._stepCount=t,this._damper=1},p.getInterval=function(){return this._interval},p.setInterval=function(Z){var x=this;x._interval!==Z&&(x._interval=Z,x._timer&&(clearInterval(x._timer),x._timer=setInterval(function(){x.relax()},Z)))},p.handleDataPropertyChange=function(M){!this._isAdjusting&&this.isVisible(M.data)&&(this._damper=1)},p.handleDataModelChange=function(){this._damper=1},p.damp=function(){var l=this._maxMotion,E=this._damper;this._motionRatio<=.001&&((.2>l||l>1&&.9>E)&&E>.01?this._damper-=.01:.4>l&&E>.003?this._damper-=.003:E>1e-4&&(this._damper-=1e-4)),l<this._motionLimit&&(this._damper=0)}}}),x.layout.ForceLayout=function($){this.init($)},x.Default.def(L+"ForceLayout",M,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(k){this._limitBounds=k,this._damper=1},getNodeSize:function(G){var i=this.gv;return i&&i.getDataUIBounds?i.getDataUIBounds(G):G.getRect()},addNode:function(q){var t=this,O=t._nodeMap[q._id];if(O)return O;var X=q.p();O={v:q,x:X.x,y:X.y,dx:0,dy:0,fix:!t.isLayoutable(q),s:t.getNodeSize(q)};var P=O.s,F=p(B(P.width)+B(P.height))*t._nodeRepulsion;return O.r=1>F?100:F,t._nodeMap[q._id]=O,t._nodes.add(O),O},addEdge:function(m){if(m._40I&&m._41I){var n=this,V=n.addNode(m._40I),h=n.addNode(m._41I),w={s:V,t:h};h=h.s,V=V.s;var U=h.width+V.width,D=h.height+V.height;w.length=p(U*U+D*D)*n._edgeRepulsion,w.length<=0&&(w.length=100),n._edges.add(w)}},relaxEdge:function(d){var G=d.t,V=d.s,k=G.x-V.x,O=G.y-V.y,v=p(k*k+O*O),E=100*d.length,b=.25*k/E*v,a=.25*O/E*v;G.dx=G.dx-b,G.dy=G.dy-a,V.dx=V.dx+b,V.dy=V.dy+a},relaxNode:function(Z,t){if(Z!==t){var C=0,x=0,V=Z.x-t.x,s=Z.y-t.y,N=V*V+s*s;0===N?(C=U(),x=U()):36e4>N&&(C=V/N,x=s/N);var a=Z.r*t.r/400;C*=a,x*=a,Z.dx+=C,Z.dy+=x,t.dx-=C,t.dy-=x}},moveNode:function(){var A=this,L=A._limitBounds,t=A._maxMotion,K=0,j=A._damper;A._nodes.each(function(V){if(!V.fix){var t=V.dx*j,c=V.dy*j;if(V.dx=t/2,V.dy=c/2,K=H(p(t*t+c*c),K),V.x+=H(-40,G(40,t)),V.y+=H(-40,G(40,c)),L){V.x<L.x&&(V.x=L.x,A.adjust(1,0)),V.y<L.y&&(V.y=L.y,A.adjust(0,1));var O=V.s;V.x+O.width>L.x+L.width&&(V.x=L.x+L.width-O.width,A.adjust(-1,0)),V.y+O.height>L.y+L.height&&(V.y=L.y+L.height-O.height,A.adjust(0,-1))}}}),A._maxMotion=K,A._motionRatio=K>0?t/K-1:0,A.damp()},adjust:function(i,F){var y=this._limitBounds;this._nodes.each(function(L){i>0?(!y||L.x+L.s.width+i<y.x+y.width)&&(L.x+=i):(!y||L.x+i>y.x)&&(L.x+=i),F>0?(!y||L.y+L.s.height+F<y.y+y.height)&&(L.y+=F):(!y||L.y+F>y.y)&&(L.y+=F)})}});var y=x.layout.Force3dLayout=function(s){this.init(s)};x.Default.def(L+"Force3dLayout",M,{ms_force:1,getNodeSize3d:function(j){return j.s3()},addNode:function(F){var J=this,K=J._nodeMap[F._id];if(K)return K;K={v:F,p:F.p3(),d:[0,0,0],fix:!J.isLayoutable(F),s:J.getNodeSize3d(F)};var Q=K.s,B=x.Default.getDistance(Q)*J._nodeRepulsion;return K.r=1>B?100:B,J._nodeMap[F._id]=K,J._nodes.add(K),K},addEdge:function(z){if(z._40I&&z._41I){var C=this,_=C.addNode(z._40I),G=C.addNode(z._41I),r={s:_,t:G};G=G.s,_=_.s,r.length=p(B(G[0]+_[0])+B(G[1]+_[1])+B(G[2]+_[2]))*C._edgeRepulsion,r.length<=0&&(r.length=100),C._edges.add(r)}},relaxEdge:function(Z){var O=Z.t.p,o=Z.s.p,b=Z.t.d,M=Z.s.d,v=O[0]-o[0],m=O[1]-o[1],l=O[2]-o[2],B=p(v*v+m*m+l*l),z=100*Z.length,G=.25*v/z*B,C=.25*m/z*B,k=.25*l/z*B;b[0]-=G,b[1]-=C,b[2]-=k,M[0]+=G,M[1]+=C,M[2]+=k},relaxNode:function(X,o){if(X!==o){var e=X.p,W=o.p,D=0,d=0,M=0,I=e[0]-W[0],S=e[1]-W[1],k=e[2]-W[2],n=I*I+S*S+k*k;0===n?(D=U(),d=U(),M=U()):216e6>n&&(D=I/n,d=S/n,M=k/n);var y=X.r*o.r/400,v=X.d,L=o.d;D*=y,d*=y,M*=y,v[0]+=D,v[1]+=d,v[2]+=M,L[0]-=D,L[1]-=d,L[2]-=M}},moveNode:function(){var T=this,q=T._maxMotion,C=0,A=T._damper;T._nodes.each(function(u){if(!u.fix){var _=u.p,r=u.d,z=r[0]*A,q=r[1]*A,I=r[2]*A;r[0]=z/2,r[1]=q/2,r[2]=I/2,C=H(p(z*z+q*q+I*I),C),_[0]+=H(-40,G(40,z)),_[1]+=H(-40,G(40,q)),_[2]+=H(-40,G(40,I))}}),T._maxMotion=C,T._motionRatio=C>0?q/C-1:0,T.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);