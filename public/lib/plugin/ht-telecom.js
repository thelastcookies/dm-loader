!function(w,t){"use strict";var S=ht.AlarmSeverity=function(r,W,R,n,m){this.value=r,this.name=W,this.nickName=R,this.color=n,this.displayName=m};ht.Default.def("ht.AlarmSeverity",t,{toString:function(){return this.displayName||this.name}}),function(){S.severities=new ht.List,S._vm={},S._nm={},S._cp=function(N,d){if(N&&d){var C=N.value-d.value;return C>0?1:0>C?-1:0}return N&&!d?1:!N&&d?-1:0},S.each=function(P,F){S.severities.each(P,F)},S.getSortFunction=function(){return S._cp},S.setSortFunction=function(J){S._cp=J,S.severities.sort(J)},S.add=function(x,M,q,h,$){var C=new S(x,M,q,h,$);return S._vm[x]=C,S._nm[M]=C,S.severities.add(C),S.severities.sort(S._cp),C},S.remove=function(O){var d=S._nm[O];return d&&(delete S._nm[O],delete S._vm[d.value],S.severities.remove(d)),d},S.CRITICAL=S.add(500,"Critical","C","#FF0000"),S.MAJOR=S.add(400,"Major","M","#FFA000"),S.MINOR=S.add(300,"Minor","m","#FFFF00"),S.WARNING=S.add(200,"Warning","W","#00FFFF"),S.INDETERMINATE=S.add(100,"Indeterminate","N","#C800FF"),S.CLEARED=S.add(0,"Cleared","R","#00FF00"),S.isClearedAlarmSeverity=function(m){return m?0===m.value:!1},S.getByName=function(i){return S._nm[i]},S.getByValue=function(T){return S._vm[T]},S.clear=function(){S.severities.clear(),S._vm={},S._nm={}},S.compare=function(J,$){return S._cp(J,$)}}();var O=ht.AlarmState=function(w){this._d=w,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",t,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var n=null;for(var F in this._am)F=S.getByName(F),S.isClearedAlarmSeverity(F)||0!==this.getAcknowledgedAlarmCount(F)&&(n=n?S.compare(n,F)>0?n:F:F);this._haa=n},_c2:function(){var F=null;for(var U in this._nm)U=S.getByName(U),S.isClearedAlarmSeverity(U)||0!==this.getNewAlarmCount(U)&&(F=F?S.compare(F,U)>0?F:U:U);this._hna=F},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var D in this._nm)if(D=S.getByName(D),!S.isClearedAlarmSeverity(D)&&0!==this.getNewAlarmCount(D)&&S.compare(this._hna,D)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var Q=this._haa,$=this._hna,M=this._ps;this._hoa=Q,S.compare($,this._hoa)>0&&(this._hoa=$),S.compare(M,this._hoa)>0&&(this._hoa=M)},_c5:function(){var E=this._haa,f=this._hna;this._hta=E,S.compare(f,this._hta)>0&&(this._hta=f)},increaseAcknowledgedAlarm:function(k,W){if(0!==W){W=W||1;var h=this._am[k.name]||0;h+=W,this._am[k.name]=h,this._f()}},increaseNewAlarm:function(Y,x){if(0!==x){x=x||1;var O=this._nm[Y.name]||0;O+=x,this._nm[Y.name]=O,this._f()}},decreaseAcknowledgedAlarm:function(Q,d){if(0!==d){d||(d=1);var s=this._am[Q.name]||0;if(s-=d,0>s)throw"Alarm count can not be negative";this._am[Q.name]=s,this._f()}},decreaseNewAlarm:function(F,K){if(0!==K){K||(K=1);var s=this._nm[F.name]||0;if(s-=K,0>s)throw"Alarm count can not be negative";this._nm[F.name]=s,this._f()}},acknowledgeAlarm:function(F){this.decreaseNewAlarm(F,1),this.increaseAcknowledgedAlarm(F,1)},acknowledgeAllAlarms:function(x){if(x){var Y=this.getNewAlarmCount(x);this.decreaseNewAlarm(x,Y),this.increaseAcknowledgedAlarm(x,Y)}else for(var H in this._nm)this.acknowledgeAllAlarms(S.getByName(H))},_c6:function(){this._aac=0;for(var R in this._am)R=S.getByName(R),this._aac+=this.getAcknowledgedAlarmCount(R)},getAcknowledgedAlarmCount:function(Q){return Q?this._am[Q.name]||0:this._aac},getAlarmCount:function(b){return this.getAcknowledgedAlarmCount(b)+this.getNewAlarmCount(b)},_c7:function(){this._nac=0;for(var p in this._nm)this._nac+=this.getNewAlarmCount(S.getByName(p))},getNewAlarmCount:function(v){return v?this._nm[v.name]||0:this._nac},setNewAlarmCount:function(N,O){this._nm[N.name]=O,this._f()},removeAllNewAlarms:function(r){r?delete this._nm[r]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(M,m){this._am[M.name]=m,this._f()},removeAllAcknowledgedAlarms:function(M){M?delete this._am[M.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){if(this._ep||(a=null),this._ps!==a){var m=this._ps;this._ps=a,this._f(),this._d.fp("propagateSeverity",m,a)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(T){var v=this._ep;this._ep=T,this._d.fp("enablePropagation",v,T)&&(T||this.setPropagateSeverity(null))}});var y=ht.AlarmStatePropagator=function(w){this._dataModel=w,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",t,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(W){this._enable!==W&&(this._enable=W,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(E){this.propagate(E)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(K){K.data&&this.propagate(K.data)},handleDataPropertyChange:function(c){if("alarmState"===c.property||"enablePropagation"===c.property)this.propagate(c.data);else if("parent"===c.property){var F=c.oldValue;F&&this.propagate(F),this.propagate(c.data)}},propagate:function(R){R&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(R),this._isPropagating=!1)},propagateToTop:function(O){for(this.propagateToParent(null,O);O&&O.getParent();)this.propagateToParent(O,O.getParent()),O=O.getParent()},propagateToParent:function(j,o){var U=null;o.getChildren().each(function(M){var I=M.getAlarmState().getHighestOverallAlarmSeverity();S.compare(I,U)>0&&(U=I)}),o.getAlarmState().setPropagateSeverity(U)}}),ht.AlarmStateStatistics=function(h){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(h)},ht.Default.def("ht.AlarmStateStatistics",t,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(E){var X=this._dataModel;X!==E&&(X&&(X.umd(this.handleDataPropertyChange,this),X.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=E,this.reset(),E.md(this.handleDataPropertyChange,this),E.mm(this.handleDataModelChange,this),this.fp("dataModel",X,E))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(f){"alarmState"===f.property&&(this.increase(f.data),this.fireAlarmStateChange())},handleDataModelChange:function(u){"add"===u.kind?(this.increase(u.data),this.fireAlarmStateChange()):"remove"===u.kind?(this.decrease(u.data),this.fireAlarmStateChange()):"clear"===u.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,S.each(function(A){var O=this.getSumInfo(A);this.sumAcked+=O.ackedCount,this.sumNew+=O.newCount,this.sumTotal+=O.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(b){if(!b)return this.sumNew;var k=this.getSumInfo(b);return k.newCount},getAcknowledgedAlarmCount:function(J){if(!J)return this.sumAcked;var q=this.getSumInfo(J);return q.ackedCount},getTotalAlarmCount:function(Q){if(!Q)return this.sumTotal;var r=this.getSumInfo(Q);return r.totalCount},getSumInfo:function(U){var f=this.severtiyMap[U.name];return f||(f={},f.newCount=0,f.ackedCount=0,f.totalCount=0,this.severtiyMap[U.name]=f),f},decrease:function(l){var d=this.dataMap[l.getId()];d&&(delete this.dataMap[l.getId()],S.each(function(J){var H=d[J.name],m=this.getSumInfo(J);m.newCount=m.newCount-H.newCount,m.ackedCount=m.ackedCount-H.ackedCount,m.totalCount=m.totalCount-H.totalCount},this))},increase:function(z){if(this.decrease(z),!this._filterFunc||this._filterFunc(z)){var N={},T=z.getAlarmState();this.dataMap[z.getId()]=N,S.each(function(I){var H={};H.newCount=T.getNewAlarmCount(I),H.ackedCount=T.getAcknowledgedAlarmCount(I),H.totalCount=T.getAlarmCount(I),N[I.name]=H;var b=this.getSumInfo(I);b.newCount=b.newCount+H.newCount,b.ackedCount=b.ackedCount+H.ackedCount,b.totalCount=b.totalCount+H.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(e){var G=this._filterFunc;this._filterFunc=e,this.reset(),this.fp("filterFunc",G,e)},getFilterFunc:function(){return this._filterFunc}});var L=ht.Data.prototype;L.getAlarmState=function(){return this._alarmState||(this._alarmState=new O(this))},L=ht.DataModel.prototype,L.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},L.setEnableAlarmStatePropagator=function(I){I!=this.isEnableAlarmStatePropagator()&&(I?(this._alarmStatePropagator=new y(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},L=ht.graph.GraphView.prototype,L.getNote2=function(t){var i=t.getAlarmState().getHighestNewAlarmSeverity();if(i){var x=t.getAlarmState().getNewAlarmCount(i)+i.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(x+="+"),x}return t.s("note2")},L.getNote2Background=function(f){var b=f.getAlarmState().getHighestNewAlarmSeverity();return b?b.color:f.s("note2.background")},L.getBodyColor=function(m){var M=m.getAlarmState().getHighestNativeAlarmSeverity();return M?M.color:m.s("body.color")},L.getBorderColor=function(x){var Z=x.getAlarmState().getPropagateSeverity();return Z?Z.color:x.s("border.color")},L=ht.widget.TreeView.prototype,L.getBorderColor=function(t){var x=t.getAlarmState().getPropagateSeverity();return x?x.color:t.s("border.color")},L.getIcon=function(f){return f.getIcon()?"__alarmIcon__":null},L=ht.widget.TreeTableView.prototype,L.getBorderColor=function(U){var z=U.getAlarmState().getPropagateSeverity();return z?z.color:U.s("border.color")},L.getIcon=function(T){return T.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(D){return D.getIcon()}},color:{func:function(t){var c=t.getAlarmState().getHighestNativeAlarmSeverity();return c?c.color:t.s("body.color")}},rect:[0,0,16,16]}]});var H=ht.Style;H["note2.expanded"]=!0,H["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);